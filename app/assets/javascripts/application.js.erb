//= require react
//= require react_ujs
//= require components

import React from "react";
import ReactDOM from "react-dom";
import Babel from "@babel/standalone";

window.React = React;
window.ReactDOM = ReactDOM;
window.Babel = Babel;

document.addEventListener("DOMContentLoaded", function () {
  const appLayoutUrl    = "<%= asset_path('components/AppLayout.jsx') %>";
  const appHeaderUrl    = "<%= asset_path('components/AppHeader.jsx') %>";
  const appSidebarUrl   = "<%= asset_path('components/AppSidebar.jsx') %>";
  const appContentUrl   = "<%= asset_path('components/AppContent.jsx') %>";
  const appFooterUrl    = "<%= asset_path('components/AppFooter.jsx') %>";
  const newsCardUrl     = "<%= asset_path('components/NewsCard.jsx') %>";
  const newsFeedUrl     = "<%= asset_path('components/NewsFeed.jsx') %>";

  Promise.all([
    fetch(appLayoutUrl).then((r) => r.text()),
    fetch(appHeaderUrl).then((r) => r.text()),
    fetch(appSidebarUrl).then((r) => r.text()),
    fetch(appContentUrl).then((r) => r.text()),
    fetch(appFooterUrl).then((r) => r.text()),
    fetch(newsCardUrl).then((r) => r.text()),
    fetch(newsFeedUrl).then((r) => r.text()),
  ])
    .then(
      ([appLayoutCode, appHeaderCode, appSidebarCode, appContentCode, appFooterCode, newsCardCode, newsFeedCode]) => {
        const compiledAppLayout = Babel.transform(appLayoutCode, { presets: ["react"] }).code;
        const compiledAppHeader = Babel.transform(appHeaderCode, { presets: ["react"] }).code;
        const compiledAppSidebar = Babel.transform(appSidebarCode, { presets: ["react"] }).code;
        const compiledAppContent = Babel.transform(appContentCode, { presets: ["react"] }).code;
        const compiledAppFooter = Babel.transform(appFooterCode, { presets: ["react"] }).code;
        const compiledNewsCard = Babel.transform(newsCardCode, { presets: ["react"] }).code;
        const compiledNewsFeed = Babel.transform(newsFeedCode, { presets: ["react"] }).code;

        eval(compiledAppLayout);
        eval(compiledAppHeader);
        eval(compiledAppSidebar);
        eval(compiledAppContent);
        eval(compiledAppFooter);
        eval(compiledNewsCard);
        eval(compiledNewsFeed);

        if (window.AppLayout) {
          ReactDOM.render(React.createElement(window.AppLayout), document.getElementById("react-root"));
        }
      }
    )
    .catch((error) => {
      console.error("Error loading JSX files:", error);
    });
});


